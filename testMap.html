<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>testmap</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/academicons-1.9.2/all.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/academicons-1.9.2/size.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-PE6RLP594L"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-PE6RLP594L', { 'anonymize_ip': true});
</script>
<style>html{ scroll-behavior: smooth; }</style>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


<link rel="stylesheet" href="styles/custom.css">
<link rel="stylesheet" href="styles/other-background.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./img/Logo-Black2.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./team.html"> 
<span class="menu-text">Team</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./science.html"> 
<span class="menu-text">Science</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-visual-stories" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Visual Stories</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-visual-stories">    
        <li>
    <a class="dropdown-item" href="./ch4_story.html">
 <span class="dropdown-text">CH4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./clouds.html">
 <span class="dropdown-text">Clouds</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Carbon-I/"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content column-page" id="quarto-document-content"><div class="quarto-title-block"><div class="quarto-title-tools-only"><h1></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>




<div class="cell">
<div class="sourceCode cell-code" id="cb1" data-startfrom="21" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 20;"><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>viewof projName <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>(</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">new</span> <span class="bu">Map</span>([</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Orthographic"</span><span class="op">,</span> <span class="st">"ortho"</span>]<span class="op">,</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Equirectangular"</span><span class="op">,</span> <span class="st">"equirectangular"</span>]<span class="op">,</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Hill"</span><span class="op">,</span> <span class="st">"hill"</span>]<span class="op">,</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Equal-Earth"</span><span class="op">,</span> <span class="st">"equalearth"</span>]<span class="op">,</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"AzEqualArea"</span><span class="op">,</span> <span class="st">"azequalarea"</span>]</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  ])<span class="op">,</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Choose projection"</span><span class="op">,</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="st">"hill"</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" data-startfrom="38" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 37;"><span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@7"</span><span class="op">,</span> <span class="st">"d3-geo-projection@4"</span><span class="op">,</span> <span class="st">"d3-inertia@0.4"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" data-startfrom="42" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 41;"><span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>netcdf <span class="op">=</span> <span class="im">import</span>(<span class="st">"https://cdn.skypack.dev/netcdfjs@2.0.2?min"</span>)<span class="op">.</span><span class="fu">then</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">NetCDFReader</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" data-startfrom="47" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 46;"><span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>reader <span class="op">=</span> <span class="kw">new</span> <span class="fu">netcdf</span>(<span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">"https://raw.githubusercontent.com/cfranken/s2_data/main/files/"</span> <span class="op">+</span> source<span class="op">.</span><span class="at">src</span>)<span class="op">.</span><span class="fu">then</span>(<span class="kw">function</span>(response) {</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response<span class="op">.</span><span class="fu">arrayBuffer</span>()<span class="op">;</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>  }))</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" data-startfrom="53" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 52;"><span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>sources <span class="op">=</span> [</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">src</span><span class="op">:</span> <span class="st">"S2_200_2000_median.nc"</span><span class="op">,</span> <span class="dt">variable</span><span class="op">:</span> <span class="st">"cloud_free_fraction02"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Median Ratio"</span>}<span class="op">,</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" data-startfrom="60" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 59;"><span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>source <span class="op">=</span> sources[dataSource]</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" data-startfrom="65" data-source-offset="-0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 64;"><span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>isize <span class="op">=</span> reader<span class="op">.</span><span class="at">header</span><span class="op">.</span><span class="at">dimensions</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">size</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>jsize <span class="op">=</span> reader<span class="op">.</span><span class="at">header</span><span class="op">.</span><span class="at">dimensions</span>[<span class="dv">1</span>]<span class="op">.</span><span class="at">size</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>zsize <span class="op">=</span> reader<span class="op">.</span><span class="at">header</span><span class="op">.</span><span class="at">dimensions</span>[<span class="dv">2</span>]<span class="op">.</span><span class="at">size</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" data-startfrom="70" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 69;"><span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>isize</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" data-startfrom="74" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 73;"><span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>jsize</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-9" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" data-startfrom="78" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 77;"><span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>zsize</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-10" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" data-startfrom="82" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 81;"><span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>topojson     <span class="op">=</span> <span class="pp">require</span>(<span class="st">'topojson'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" data-startfrom="86" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 85;"><span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> {</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> values <span class="op">=</span> <span class="kw">new</span> <span class="bu">Float32Array</span>(reader<span class="op">.</span><span class="fu">getDataVariable</span>(source<span class="op">.</span><span class="at">variable</span>))<span class="op">;</span></span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> values<span class="op">;</span></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" data-startfrom="93" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 92;"><span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>polygons <span class="op">=</span> <span class="fu">contours</span>(<span class="fu">cylinder</span>(<span class="fu">topdown</span>(values)))<span class="op">.</span><span class="fu">map</span>(invert)<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(p) {</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> p<span class="op">.</span><span class="at">type</span> <span class="op">==</span> <span class="st">"Polygon"</span> <span class="op">?</span> <span class="fu">simplify</span>(p<span class="op">,</span> <span class="fl">0.01</span>) <span class="op">:</span> p<span class="op">;</span></span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" data-startfrom="99" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 98;"><span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">simplify</span>(polygon<span class="op">,</span> s) {</span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> topology <span class="op">=</span> topojson<span class="op">.</span><span class="fu">topology</span>({<span class="dt">polygon</span><span class="op">:</span> polygon})<span class="op">;</span></span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>    topology <span class="op">=</span> topojson<span class="op">.</span><span class="fu">simplify</span>(topojson<span class="op">.</span><span class="fu">presimplify</span>(topology)<span class="op">,</span> s)<span class="op">;</span></span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>    topology <span class="op">=</span> topojson<span class="op">.</span><span class="fu">filter</span>(topology<span class="op">,</span> r <span class="kw">=&gt;</span> topology<span class="op">.</span><span class="at">arcs</span>[r[<span class="dv">0</span>]]<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> p <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(topology<span class="op">,</span> topology<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">polygon</span>)<span class="op">;</span></span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a>    p<span class="op">.</span><span class="at">value</span> <span class="op">=</span> polygon<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> p<span class="op">;</span></span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" data-startfrom="110" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 109;"><span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">invert</span>(d) {</span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> shared <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> p <span class="op">=</span> {</span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"Polygon"</span><span class="op">,</span></span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a>      <span class="dt">coordinates</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">merge</span>(d<span class="op">.</span><span class="at">coordinates</span><span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(polygon) {</span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> polygon<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(ring) {</span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> ring<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(point) {</span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> [point[<span class="dv">0</span>] <span class="op">/</span> (isize <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">360</span> <span class="op">-</span> <span class="dv">180</span><span class="op">,</span> <span class="dv">90</span> <span class="op">-</span> point[<span class="dv">1</span>] <span class="op">/</span> jsize <span class="op">*</span> <span class="dv">180</span>]<span class="op">;</span></span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a>          })<span class="op">.</span><span class="fu">reverse</span>()<span class="op">;</span></span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a>      }))</span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add contact points with the antimeridian.</span></span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> epsilon <span class="op">=</span> <span class="fl">1e-5</span><span class="op">;</span></span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a>    p<span class="op">.</span><span class="at">coordinates</span> <span class="op">=</span> p<span class="op">.</span><span class="at">coordinates</span></span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(ring) {</span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a>      ring<span class="op">.</span><span class="fu">pop</span>()<span class="op">;</span></span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> r <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> l <span class="op">=</span> ring<span class="op">.</span><span class="at">length</span><span class="op">;</span> i <span class="op">&lt;</span> l<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> p <span class="op">=</span> ring[i]<span class="op">;</span></span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (p[<span class="dv">0</span>] <span class="op">===</span> <span class="dv">180</span> <span class="op">&amp;&amp;</span> ring[(i<span class="op">+</span>l<span class="op">-</span><span class="dv">1</span>)<span class="op">%</span>l][<span class="dv">0</span>] <span class="op">&lt;</span> <span class="dv">180</span>)</span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true" tabindex="-1"></a>            r<span class="op">.</span><span class="fu">push</span>([p[<span class="dv">0</span>]<span class="op">,</span> p[<span class="dv">1</span>] <span class="op">+</span> epsilon])<span class="op">;</span></span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (p[<span class="dv">0</span>] <span class="op">===</span> <span class="op">-</span><span class="dv">180</span> <span class="op">&amp;&amp;</span> ring[(i<span class="op">+</span>l<span class="op">-</span><span class="dv">1</span>)<span class="op">%</span>l][<span class="dv">0</span>] <span class="op">&gt;</span> <span class="op">-</span><span class="dv">180</span>)</span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true" tabindex="-1"></a>            r<span class="op">.</span><span class="fu">push</span>([p[<span class="dv">0</span>]<span class="op">,</span> p[<span class="dv">1</span>] <span class="op">-</span> epsilon])<span class="op">;</span></span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true" tabindex="-1"></a>        r<span class="op">.</span><span class="fu">push</span>(p)<span class="op">;</span></span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (p[<span class="dv">0</span>] <span class="op">===</span> <span class="dv">180</span> <span class="op">&amp;&amp;</span> ring[(i<span class="op">+</span><span class="dv">1</span>)<span class="op">%</span>l][<span class="dv">0</span>] <span class="op">&lt;</span> <span class="dv">180</span>)</span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true" tabindex="-1"></a>            r<span class="op">.</span><span class="fu">push</span>([p[<span class="dv">0</span>]<span class="op">,</span> p[<span class="dv">1</span>] <span class="op">-</span> epsilon])<span class="op">;</span></span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (p[<span class="dv">0</span>] <span class="op">===</span> <span class="op">-</span><span class="dv">180</span> <span class="op">&amp;&amp;</span> ring[(i<span class="op">+</span><span class="dv">1</span>)<span class="op">%</span>l][<span class="dv">0</span>] <span class="op">&gt;</span> <span class="op">-</span><span class="dv">180</span>)</span>
<span id="cb15-139"><a href="#cb15-139" aria-hidden="true" tabindex="-1"></a>            r<span class="op">.</span><span class="fu">push</span>([p[<span class="dv">0</span>]<span class="op">,</span> p[<span class="dv">1</span>] <span class="op">+</span> epsilon])<span class="op">;</span></span>
<span id="cb15-140"><a href="#cb15-140" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb15-141"><a href="#cb15-141" aria-hidden="true" tabindex="-1"></a>      r<span class="op">.</span><span class="fu">push</span>(r[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb15-142"><a href="#cb15-142" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> r<span class="op">;</span></span>
<span id="cb15-143"><a href="#cb15-143" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb15-144"><a href="#cb15-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-145"><a href="#cb15-145" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Record the y-intersections with the antimeridian.</span></span>
<span id="cb15-146"><a href="#cb15-146" aria-hidden="true" tabindex="-1"></a>    p<span class="op">.</span><span class="at">coordinates</span><span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span>(ring) {</span>
<span id="cb15-147"><a href="#cb15-147" aria-hidden="true" tabindex="-1"></a>      ring<span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span>(p) {</span>
<span id="cb15-148"><a href="#cb15-148" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (p[<span class="dv">0</span>] <span class="op">===</span> <span class="op">-</span><span class="dv">180</span> <span class="op">||</span> p[<span class="dv">0</span>] <span class="op">===</span> <span class="dv">180</span>) {</span>
<span id="cb15-149"><a href="#cb15-149" aria-hidden="true" tabindex="-1"></a>          shared[p[<span class="dv">1</span>]] <span class="op">|=</span> p[<span class="dv">0</span>] <span class="op">===</span> <span class="op">-</span><span class="dv">180</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb15-150"><a href="#cb15-150" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb15-151"><a href="#cb15-151" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb15-152"><a href="#cb15-152" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb15-153"><a href="#cb15-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-154"><a href="#cb15-154" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Offset any unshared antimeridian points to prevent their stitching.</span></span>
<span id="cb15-155"><a href="#cb15-155" aria-hidden="true" tabindex="-1"></a>    p<span class="op">.</span><span class="at">coordinates</span><span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span>(ring) {</span>
<span id="cb15-156"><a href="#cb15-156" aria-hidden="true" tabindex="-1"></a>      ring<span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span>(p) {</span>
<span id="cb15-157"><a href="#cb15-157" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ((p[<span class="dv">0</span>] <span class="op">===</span> <span class="op">-</span><span class="dv">180</span> <span class="op">||</span> p[<span class="dv">0</span>] <span class="op">===</span> <span class="dv">180</span>) <span class="op">&amp;&amp;</span> shared[p[<span class="dv">1</span>]] <span class="op">!==</span> <span class="dv">3</span>) {</span>
<span id="cb15-158"><a href="#cb15-158" aria-hidden="true" tabindex="-1"></a>          p[<span class="dv">0</span>] <span class="op">=</span> p[<span class="dv">0</span>] <span class="op">===</span> <span class="op">-</span><span class="dv">180</span> <span class="op">?</span> <span class="op">-</span><span class="fl">179.9995</span> <span class="op">:</span> <span class="fl">179.9995</span><span class="op">;</span></span>
<span id="cb15-159"><a href="#cb15-159" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb15-160"><a href="#cb15-160" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb15-161"><a href="#cb15-161" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb15-162"><a href="#cb15-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-163"><a href="#cb15-163" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoStitch</span>(p)<span class="op">;</span></span>
<span id="cb15-164"><a href="#cb15-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-165"><a href="#cb15-165" aria-hidden="true" tabindex="-1"></a>    <span class="co">// After stitching remove the shared points -- they are off</span></span>
<span id="cb15-166"><a href="#cb15-166" aria-hidden="true" tabindex="-1"></a>    <span class="co">// see https://github.com/d3/d3-contour/issues/25</span></span>
<span id="cb15-167"><a href="#cb15-167" aria-hidden="true" tabindex="-1"></a>    p<span class="op">.</span><span class="at">coordinates</span> <span class="op">=</span> p<span class="op">.</span><span class="at">coordinates</span></span>
<span id="cb15-168"><a href="#cb15-168" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(ring) {</span>
<span id="cb15-169"><a href="#cb15-169" aria-hidden="true" tabindex="-1"></a>      ring<span class="op">.</span><span class="fu">pop</span>()<span class="op">;</span></span>
<span id="cb15-170"><a href="#cb15-170" aria-hidden="true" tabindex="-1"></a>      ring <span class="op">=</span> ring</span>
<span id="cb15-171"><a href="#cb15-171" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(p) {</span>
<span id="cb15-172"><a href="#cb15-172" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> p0 <span class="op">=</span> (p[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">180</span>) <span class="op">*</span> (isize <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> isize <span class="op">-</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb15-173"><a href="#cb15-173" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [p0<span class="op">,</span> p[<span class="dv">1</span>]]<span class="op">;</span></span>
<span id="cb15-174"><a href="#cb15-174" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb15-175"><a href="#cb15-175" aria-hidden="true" tabindex="-1"></a>      ring <span class="op">=</span> ring<span class="op">.</span><span class="fu">filter</span>(<span class="kw">function</span>(p) {</span>
<span id="cb15-176"><a href="#cb15-176" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(p[<span class="dv">0</span>]) <span class="op">&lt;</span> <span class="fl">179.9999</span><span class="op">;</span></span>
<span id="cb15-177"><a href="#cb15-177" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb15-178"><a href="#cb15-178" aria-hidden="true" tabindex="-1"></a>      ring<span class="op">.</span><span class="fu">push</span>(ring[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb15-179"><a href="#cb15-179" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> ring<span class="op">;</span></span>
<span id="cb15-180"><a href="#cb15-180" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb15-181"><a href="#cb15-181" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(<span class="kw">function</span>(ring) {</span>
<span id="cb15-182"><a href="#cb15-182" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> ring<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb15-183"><a href="#cb15-183" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb15-184"><a href="#cb15-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-185"><a href="#cb15-185" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If the MultiPolygon is empty, treat it as the Sphere.</span></span>
<span id="cb15-186"><a href="#cb15-186" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> p<span class="op">.</span><span class="at">coordinates</span><span class="op">.</span><span class="at">length</span></span>
<span id="cb15-187"><a href="#cb15-187" aria-hidden="true" tabindex="-1"></a>        <span class="op">?</span> {<span class="dt">type</span><span class="op">:</span> <span class="st">"Polygon"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> p<span class="op">.</span><span class="at">coordinates</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d<span class="op">.</span><span class="at">value</span>}</span>
<span id="cb15-188"><a href="#cb15-188" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span> {<span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d<span class="op">.</span><span class="at">value</span>}<span class="op">;</span></span>
<span id="cb15-189"><a href="#cb15-189" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-190"><a href="#cb15-190" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" data-startfrom="194" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 193;"><span id="cb16-194"><a href="#cb16-194" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">topdown</span>(values) {</span>
<span id="cb16-195"><a href="#cb16-195" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> v <span class="op">=</span> <span class="kw">new</span> <span class="bu">Float32Array</span>(values)<span class="op">;</span></span>
<span id="cb16-196"><a href="#cb16-196" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">var</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> jsize<span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb16-197"><a href="#cb16-197" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> isize<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb16-198"><a href="#cb16-198" aria-hidden="true" tabindex="-1"></a>      v[ (jsize<span class="op">-</span><span class="dv">1</span><span class="op">-</span>j) <span class="op">*</span> isize <span class="op">+</span> i ] <span class="op">=</span> values[ j <span class="op">*</span> isize <span class="op">+</span> i ]<span class="op">;</span></span>
<span id="cb16-199"><a href="#cb16-199" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-200"><a href="#cb16-200" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-201"><a href="#cb16-201" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> v<span class="op">;</span></span>
<span id="cb16-202"><a href="#cb16-202" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" data-startfrom="206" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 205;"><span id="cb17-206"><a href="#cb17-206" aria-hidden="true" tabindex="-1"></a><span class="co">// torus: copy left column to the right</span></span>
<span id="cb17-207"><a href="#cb17-207" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">cylinder</span>(values) {</span>
<span id="cb17-208"><a href="#cb17-208" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> v <span class="op">=</span> <span class="kw">new</span> <span class="bu">Float32Array</span>(jsize <span class="op">*</span> (isize<span class="op">+</span><span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb17-209"><a href="#cb17-209" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">var</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> jsize<span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb17-210"><a href="#cb17-210" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> isize <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb17-211"><a href="#cb17-211" aria-hidden="true" tabindex="-1"></a>      v[ j <span class="op">*</span> (isize<span class="op">+</span><span class="dv">1</span>) <span class="op">+</span> i ] <span class="op">=</span> values[ j <span class="op">*</span> isize <span class="op">+</span> i<span class="op">%</span>isize ]<span class="op">;</span></span>
<span id="cb17-212"><a href="#cb17-212" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb17-213"><a href="#cb17-213" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb17-214"><a href="#cb17-214" aria-hidden="true" tabindex="-1"></a> <span class="cf">return</span> v<span class="op">;</span></span>
<span id="cb17-215"><a href="#cb17-215" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" data-startfrom="219" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 218;"><span id="cb18-219"><a href="#cb18-219" aria-hidden="true" tabindex="-1"></a>contours <span class="op">=</span> d3<span class="op">.</span><span class="fu">contours</span>()</span>
<span id="cb18-220"><a href="#cb18-220" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">smooth</span>(<span class="kw">true</span>)</span>
<span id="cb18-221"><a href="#cb18-221" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">size</span>([isize <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> jsize])</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" data-startfrom="225" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 224;"><span id="cb19-225"><a href="#cb19-225" aria-hidden="true" tabindex="-1"></a>polygons</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-19" data-nodetype="expression">

</div>
</div>
</div>


<!-- -->


</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBwcm9qTmFtZSA9IElucHV0cy5yYWRpbyhcbiAgbmV3IE1hcChbXG4gICAgW1wiT3J0aG9ncmFwaGljXCIsIFwib3J0aG9cIl0sXG4gICAgW1wiRXF1aXJlY3Rhbmd1bGFyXCIsIFwiZXF1aXJlY3Rhbmd1bGFyXCJdLFxuICAgIFtcIkhpbGxcIiwgXCJoaWxsXCJdLFxuICAgIFtcIkVxdWFsLUVhcnRoXCIsIFwiZXF1YWxlYXJ0aFwiXSxcbiAgICBbXCJBekVxdWFsQXJlYVwiLCBcImF6ZXF1YWxhcmVhXCJdXG4gIF0pLFxuICB7XG4gICAgbGFiZWw6IFwiQ2hvb3NlIHByb2plY3Rpb25cIixcbiAgICB2YWx1ZTogXCJoaWxsXCJcbiAgfVxuKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZDMgPSByZXF1aXJlKFwiZDNAN1wiLCBcImQzLWdlby1wcm9qZWN0aW9uQDRcIiwgXCJkMy1pbmVydGlhQDAuNFwiKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibmV0Y2RmID0gaW1wb3J0KFwiaHR0cHM6Ly9jZG4uc2t5cGFjay5kZXYvbmV0Y2RmanNAMi4wLjI/bWluXCIpLnRoZW4oKGQpID0+IGQuTmV0Q0RGUmVhZGVyKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVhZGVyID0gbmV3IG5ldGNkZihhd2FpdCBmZXRjaChcImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jZnJhbmtlbi9zMl9kYXRhL21haW4vZmlsZXMvXCIgKyBzb3VyY2Uuc3JjKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgcmV0dXJuIHJlc3BvbnNlLmFycmF5QnVmZmVyKCk7XG4gIH0pKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoic291cmNlcyA9IFtcbiAge3NyYzogXCJTMl8yMDBfMjAwMF9tZWRpYW4ubmNcIiwgdmFyaWFibGU6IFwiY2xvdWRfZnJlZV9mcmFjdGlvbjAyXCIsIGxhYmVsOiBcIk1lZGlhbiBSYXRpb1wifSxcbl1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InNvdXJjZSA9IHNvdXJjZXNbZGF0YVNvdXJjZV1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImlzaXplID0gcmVhZGVyLmhlYWRlci5kaW1lbnNpb25zWzBdLnNpemVcbmpzaXplID0gcmVhZGVyLmhlYWRlci5kaW1lbnNpb25zWzFdLnNpemVcbnpzaXplID0gcmVhZGVyLmhlYWRlci5kaW1lbnNpb25zWzJdLnNpemVcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImlzaXplXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJqc2l6ZVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InpzaXplXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTExIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidG9wb2pzb24gICAgID0gcmVxdWlyZSgndG9wb2pzb24nKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZhbHVlcyA9IHtcbiAgdmFyIHZhbHVlcyA9IG5ldyBGbG9hdDMyQXJyYXkocmVhZGVyLmdldERhdGFWYXJpYWJsZShzb3VyY2UudmFyaWFibGUpKTtcbiAgcmV0dXJuIHZhbHVlcztcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwb2x5Z29ucyA9IGNvbnRvdXJzKGN5bGluZGVyKHRvcGRvd24odmFsdWVzKSkpLm1hcChpbnZlcnQpLm1hcChmdW5jdGlvbihwKSB7XG4gIHJldHVybiBwLnR5cGUgPT0gXCJQb2x5Z29uXCIgPyBzaW1wbGlmeShwLCAwLjAxKSA6IHA7XG59KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIHNpbXBsaWZ5KHBvbHlnb24sIHMpIHtcbiAgICB2YXIgdG9wb2xvZ3kgPSB0b3BvanNvbi50b3BvbG9neSh7cG9seWdvbjogcG9seWdvbn0pO1xuICAgIHRvcG9sb2d5ID0gdG9wb2pzb24uc2ltcGxpZnkodG9wb2pzb24ucHJlc2ltcGxpZnkodG9wb2xvZ3kpLCBzKTtcbiAgICB0b3BvbG9neSA9IHRvcG9qc29uLmZpbHRlcih0b3BvbG9neSwgciA9PiB0b3BvbG9neS5hcmNzW3JbMF1dLmxlbmd0aCA+IDIpO1xuICAgIHZhciBwID0gdG9wb2pzb24uZmVhdHVyZSh0b3BvbG9neSwgdG9wb2xvZ3kub2JqZWN0cy5wb2x5Z29uKTtcbiAgICBwLnZhbHVlID0gcG9seWdvbi52YWx1ZTtcbiAgICByZXR1cm4gcDtcbiAgfVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGludmVydChkKSB7XG4gICAgdmFyIHNoYXJlZCA9IHt9O1xuICAgIHZhciBwID0ge1xuICAgICAgdHlwZTogXCJQb2x5Z29uXCIsXG4gICAgICBjb29yZGluYXRlczogZDMubWVyZ2UoZC5jb29yZGluYXRlcy5tYXAoZnVuY3Rpb24ocG9seWdvbikge1xuICAgICAgICByZXR1cm4gcG9seWdvbi5tYXAoZnVuY3Rpb24ocmluZykge1xuICAgICAgICAgIHJldHVybiByaW5nLm1hcChmdW5jdGlvbihwb2ludCkge1xuICAgICAgICAgICAgcmV0dXJuIFtwb2ludFswXSAvIChpc2l6ZSArIDEpICogMzYwIC0gMTgwLCA5MCAtIHBvaW50WzFdIC8ganNpemUgKiAxODBdO1xuICAgICAgICAgIH0pLnJldmVyc2UoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KSlcbiAgICB9O1xuXG4gICAgLy8gQWRkIGNvbnRhY3QgcG9pbnRzIHdpdGggdGhlIGFudGltZXJpZGlhbi5cbiAgICB2YXIgZXBzaWxvbiA9IDFlLTU7XG4gICAgcC5jb29yZGluYXRlcyA9IHAuY29vcmRpbmF0ZXNcbiAgICAubWFwKGZ1bmN0aW9uKHJpbmcpIHtcbiAgICAgIHJpbmcucG9wKCk7XG4gICAgICB2YXIgciA9IFtdO1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSByaW5nLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICB2YXIgcCA9IHJpbmdbaV07XG4gICAgICAgIGlmIChwWzBdID09PSAxODAgJiYgcmluZ1soaStsLTEpJWxdWzBdIDwgMTgwKVxuICAgICAgICBcdHIucHVzaChbcFswXSwgcFsxXSArIGVwc2lsb25dKTtcbiAgICAgICAgaWYgKHBbMF0gPT09IC0xODAgJiYgcmluZ1soaStsLTEpJWxdWzBdID4gLTE4MClcbiAgICAgICAgXHRyLnB1c2goW3BbMF0sIHBbMV0gLSBlcHNpbG9uXSk7XG4gICAgICAgIHIucHVzaChwKTtcbiAgICAgICAgaWYgKHBbMF0gPT09IDE4MCAmJiByaW5nWyhpKzEpJWxdWzBdIDwgMTgwKVxuICAgICAgICBcdHIucHVzaChbcFswXSwgcFsxXSAtIGVwc2lsb25dKTtcbiAgICAgICAgaWYgKHBbMF0gPT09IC0xODAgJiYgcmluZ1soaSsxKSVsXVswXSA+IC0xODApXG4gICAgICAgIFx0ci5wdXNoKFtwWzBdLCBwWzFdICsgZXBzaWxvbl0pO1xuICAgICAgfVxuICAgICAgci5wdXNoKHJbMF0pO1xuICAgICAgcmV0dXJuIHI7XG4gICAgfSk7XG5cbiAgICAvLyBSZWNvcmQgdGhlIHktaW50ZXJzZWN0aW9ucyB3aXRoIHRoZSBhbnRpbWVyaWRpYW4uXG4gICAgcC5jb29yZGluYXRlcy5mb3JFYWNoKGZ1bmN0aW9uKHJpbmcpIHtcbiAgICAgIHJpbmcuZm9yRWFjaChmdW5jdGlvbihwKSB7XG4gICAgICAgIGlmIChwWzBdID09PSAtMTgwIHx8IHBbMF0gPT09IDE4MCkge1xuICAgICAgICAgIHNoYXJlZFtwWzFdXSB8PSBwWzBdID09PSAtMTgwID8gMSA6IDI7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gT2Zmc2V0IGFueSB1bnNoYXJlZCBhbnRpbWVyaWRpYW4gcG9pbnRzIHRvIHByZXZlbnQgdGhlaXIgc3RpdGNoaW5nLlxuICAgIHAuY29vcmRpbmF0ZXMuZm9yRWFjaChmdW5jdGlvbihyaW5nKSB7XG4gICAgICByaW5nLmZvckVhY2goZnVuY3Rpb24ocCkge1xuICAgICAgICBpZiAoKHBbMF0gPT09IC0xODAgfHwgcFswXSA9PT0gMTgwKSAmJiBzaGFyZWRbcFsxXV0gIT09IDMpIHtcbiAgICAgICAgICBwWzBdID0gcFswXSA9PT0gLTE4MCA/IC0xNzkuOTk5NSA6IDE3OS45OTk1O1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHAgPSBkMy5nZW9TdGl0Y2gocCk7XG5cbiAgICAvLyBBZnRlciBzdGl0Y2hpbmcgcmVtb3ZlIHRoZSBzaGFyZWQgcG9pbnRzIC0tIHRoZXkgYXJlIG9mZlxuICAgIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZDMvZDMtY29udG91ci9pc3N1ZXMvMjVcbiAgICBwLmNvb3JkaW5hdGVzID0gcC5jb29yZGluYXRlc1xuICAgIC5tYXAoZnVuY3Rpb24ocmluZykge1xuICAgICAgcmluZy5wb3AoKTtcbiAgICAgIHJpbmcgPSByaW5nXG4gICAgICAubWFwKGZ1bmN0aW9uKHApIHtcbiAgICAgIFx0dmFyIHAwID0gKHBbMF0gKyAxODApICogKGlzaXplICsgMSkgLyBpc2l6ZSAtIDE4MDtcbiAgICAgICAgcmV0dXJuIFtwMCwgcFsxXV07XG4gICAgICB9KTtcbiAgICAgIHJpbmcgPSByaW5nLmZpbHRlcihmdW5jdGlvbihwKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmFicyhwWzBdKSA8IDE3OS45OTk5O1xuICAgICAgfSk7XG4gICAgICByaW5nLnB1c2gocmluZ1swXSk7XG4gICAgICByZXR1cm4gcmluZztcbiAgICB9KVxuICAgIC5maWx0ZXIoZnVuY3Rpb24ocmluZykge1xuICAgICAgcmV0dXJuIHJpbmcubGVuZ3RoID4gMDtcbiAgICB9KTtcblxuICAgIC8vIElmIHRoZSBNdWx0aVBvbHlnb24gaXMgZW1wdHksIHRyZWF0IGl0IGFzIHRoZSBTcGhlcmUuXG4gICAgcmV0dXJuIHAuY29vcmRpbmF0ZXMubGVuZ3RoXG4gICAgICAgID8ge3R5cGU6IFwiUG9seWdvblwiLCBjb29yZGluYXRlczogcC5jb29yZGluYXRlcywgdmFsdWU6IGQudmFsdWV9XG4gICAgICAgIDoge3R5cGU6IFwiU3BoZXJlXCIsIHZhbHVlOiBkLnZhbHVlfTtcbiAgICBcbiAgfVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIHRvcGRvd24odmFsdWVzKSB7XG4gIHZhciB2ID0gbmV3IEZsb2F0MzJBcnJheSh2YWx1ZXMpO1xuICBmb3IgKHZhciBqID0gMDsgaiA8IGpzaXplOyBqKyspIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlzaXplOyBpKyspIHtcbiAgICAgIHZbIChqc2l6ZS0xLWopICogaXNpemUgKyBpIF0gPSB2YWx1ZXNbIGogKiBpc2l6ZSArIGkgXTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHY7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gdG9ydXM6IGNvcHkgbGVmdCBjb2x1bW4gdG8gdGhlIHJpZ2h0XG5mdW5jdGlvbiBjeWxpbmRlcih2YWx1ZXMpIHtcbiAgdmFyIHYgPSBuZXcgRmxvYXQzMkFycmF5KGpzaXplICogKGlzaXplKzEpKTtcbiAgZm9yICh2YXIgaiA9IDA7IGogPCBqc2l6ZTsgaisrKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpc2l6ZSArIDE7IGkrKykge1xuICAgICAgdlsgaiAqIChpc2l6ZSsxKSArIGkgXSA9IHZhbHVlc1sgaiAqIGlzaXplICsgaSVpc2l6ZSBdO1xuICAgICB9XG4gfVxuIHJldHVybiB2O1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImNvbnRvdXJzID0gZDMuY29udG91cnMoKVxuICAgICAgLnNtb290aCh0cnVlKVxuICAgICAgLnNpemUoW2lzaXplICsgMSwganNpemVdKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBvbHlnb25zXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3Byb2pOYW1lJykifV19
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/carbon-i\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb20" data-shortcodes="false"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="an">comments:</span><span class="co"> false</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="an">page-layout:</span><span class="co"> full</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">    css: styles/other-background.css  </span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">    margin-top: 0em</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">    margin-bottom: 0em</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">    minimal: true</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-responsive: true</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co">    #echo: false</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">    #keep-hidden: true</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="in">viewof projName = Inputs.radio(</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="in">  new Map([</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="in">    ["Orthographic", "ortho"],</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="in">    ["Equirectangular", "equirectangular"],</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="in">    ["Hill", "hill"],</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="in">    ["Equal-Earth", "equalearth"],</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="in">    ["AzEqualArea", "azequalarea"]</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="in">  ]),</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="in">  {</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="in">    label: "Choose projection",</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a><span class="in">    value: "hill"</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="in">d3 = require("d3@7", "d3-geo-projection@4", "d3-inertia@0.4")</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="in">netcdf = import("https://cdn.skypack.dev/netcdfjs@2.0.2?min").then((d) =&gt; d.NetCDFReader)</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="in">reader = new netcdf(await fetch("https://raw.githubusercontent.com/cfranken/s2_data/main/files/" + source.src).then(function(response) {</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="in">    return response.arrayBuffer();</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a><span class="in">  }))</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a><span class="in">sources = [</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a><span class="in">  {src: "S2_200_2000_median.nc", variable: "cloud_free_fraction02", label: "Median Ratio"},</span></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a><span class="in">]</span></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a><span class="in">source = sources[dataSource]</span></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a><span class="in">isize = reader.header.dimensions[0].size</span></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a><span class="in">jsize = reader.header.dimensions[1].size</span></span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a><span class="in">zsize = reader.header.dimensions[2].size</span></span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a><span class="in">isize</span></span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a><span class="in">jsize</span></span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a><span class="in">zsize</span></span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a><span class="in">topojson     = require('topojson')</span></span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a><span class="in">values = {</span></span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a><span class="in">  var values = new Float32Array(reader.getDataVariable(source.variable));</span></span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a><span class="in">  return values;</span></span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a><span class="in">polygons = contours(cylinder(topdown(values))).map(invert).map(function(p) {</span></span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a><span class="in">  return p.type == "Polygon" ? simplify(p, 0.01) : p;</span></span>
<span id="cb20-122"><a href="#cb20-122" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb20-123"><a href="#cb20-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-124"><a href="#cb20-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-127"><a href="#cb20-127" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-128"><a href="#cb20-128" aria-hidden="true" tabindex="-1"></a><span class="in">function simplify(polygon, s) {</span></span>
<span id="cb20-129"><a href="#cb20-129" aria-hidden="true" tabindex="-1"></a><span class="in">    var topology = topojson.topology({polygon: polygon});</span></span>
<span id="cb20-130"><a href="#cb20-130" aria-hidden="true" tabindex="-1"></a><span class="in">    topology = topojson.simplify(topojson.presimplify(topology), s);</span></span>
<span id="cb20-131"><a href="#cb20-131" aria-hidden="true" tabindex="-1"></a><span class="in">    topology = topojson.filter(topology, r =&gt; topology.arcs[r[0]].length &gt; 2);</span></span>
<span id="cb20-132"><a href="#cb20-132" aria-hidden="true" tabindex="-1"></a><span class="in">    var p = topojson.feature(topology, topology.objects.polygon);</span></span>
<span id="cb20-133"><a href="#cb20-133" aria-hidden="true" tabindex="-1"></a><span class="in">    p.value = polygon.value;</span></span>
<span id="cb20-134"><a href="#cb20-134" aria-hidden="true" tabindex="-1"></a><span class="in">    return p;</span></span>
<span id="cb20-135"><a href="#cb20-135" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb20-136"><a href="#cb20-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-137"><a href="#cb20-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-140"><a href="#cb20-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-141"><a href="#cb20-141" aria-hidden="true" tabindex="-1"></a><span class="in">function invert(d) {</span></span>
<span id="cb20-142"><a href="#cb20-142" aria-hidden="true" tabindex="-1"></a><span class="in">    var shared = {};</span></span>
<span id="cb20-143"><a href="#cb20-143" aria-hidden="true" tabindex="-1"></a><span class="in">    var p = {</span></span>
<span id="cb20-144"><a href="#cb20-144" aria-hidden="true" tabindex="-1"></a><span class="in">      type: "Polygon",</span></span>
<span id="cb20-145"><a href="#cb20-145" aria-hidden="true" tabindex="-1"></a><span class="in">      coordinates: d3.merge(d.coordinates.map(function(polygon) {</span></span>
<span id="cb20-146"><a href="#cb20-146" aria-hidden="true" tabindex="-1"></a><span class="in">        return polygon.map(function(ring) {</span></span>
<span id="cb20-147"><a href="#cb20-147" aria-hidden="true" tabindex="-1"></a><span class="in">          return ring.map(function(point) {</span></span>
<span id="cb20-148"><a href="#cb20-148" aria-hidden="true" tabindex="-1"></a><span class="in">            return [point[0] / (isize + 1) * 360 - 180, 90 - point[1] / jsize * 180];</span></span>
<span id="cb20-149"><a href="#cb20-149" aria-hidden="true" tabindex="-1"></a><span class="in">          }).reverse();</span></span>
<span id="cb20-150"><a href="#cb20-150" aria-hidden="true" tabindex="-1"></a><span class="in">        });</span></span>
<span id="cb20-151"><a href="#cb20-151" aria-hidden="true" tabindex="-1"></a><span class="in">      }))</span></span>
<span id="cb20-152"><a href="#cb20-152" aria-hidden="true" tabindex="-1"></a><span class="in">    };</span></span>
<span id="cb20-153"><a href="#cb20-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-154"><a href="#cb20-154" aria-hidden="true" tabindex="-1"></a><span class="in">    // Add contact points with the antimeridian.</span></span>
<span id="cb20-155"><a href="#cb20-155" aria-hidden="true" tabindex="-1"></a><span class="in">    var epsilon = 1e-5;</span></span>
<span id="cb20-156"><a href="#cb20-156" aria-hidden="true" tabindex="-1"></a><span class="in">    p.coordinates = p.coordinates</span></span>
<span id="cb20-157"><a href="#cb20-157" aria-hidden="true" tabindex="-1"></a><span class="in">    .map(function(ring) {</span></span>
<span id="cb20-158"><a href="#cb20-158" aria-hidden="true" tabindex="-1"></a><span class="in">      ring.pop();</span></span>
<span id="cb20-159"><a href="#cb20-159" aria-hidden="true" tabindex="-1"></a><span class="in">      var r = [];</span></span>
<span id="cb20-160"><a href="#cb20-160" aria-hidden="true" tabindex="-1"></a><span class="in">      for (var i = 0, l = ring.length; i &lt; l; i++) {</span></span>
<span id="cb20-161"><a href="#cb20-161" aria-hidden="true" tabindex="-1"></a><span class="in">        var p = ring[i];</span></span>
<span id="cb20-162"><a href="#cb20-162" aria-hidden="true" tabindex="-1"></a><span class="in">        if (p[0] === 180 &amp;&amp; ring[(i+l-1)%l][0] &lt; 180)</span></span>
<span id="cb20-163"><a href="#cb20-163" aria-hidden="true" tabindex="-1"></a><span class="in">            r.push([p[0], p[1] + epsilon]);</span></span>
<span id="cb20-164"><a href="#cb20-164" aria-hidden="true" tabindex="-1"></a><span class="in">        if (p[0] === -180 &amp;&amp; ring[(i+l-1)%l][0] &gt; -180)</span></span>
<span id="cb20-165"><a href="#cb20-165" aria-hidden="true" tabindex="-1"></a><span class="in">            r.push([p[0], p[1] - epsilon]);</span></span>
<span id="cb20-166"><a href="#cb20-166" aria-hidden="true" tabindex="-1"></a><span class="in">        r.push(p);</span></span>
<span id="cb20-167"><a href="#cb20-167" aria-hidden="true" tabindex="-1"></a><span class="in">        if (p[0] === 180 &amp;&amp; ring[(i+1)%l][0] &lt; 180)</span></span>
<span id="cb20-168"><a href="#cb20-168" aria-hidden="true" tabindex="-1"></a><span class="in">            r.push([p[0], p[1] - epsilon]);</span></span>
<span id="cb20-169"><a href="#cb20-169" aria-hidden="true" tabindex="-1"></a><span class="in">        if (p[0] === -180 &amp;&amp; ring[(i+1)%l][0] &gt; -180)</span></span>
<span id="cb20-170"><a href="#cb20-170" aria-hidden="true" tabindex="-1"></a><span class="in">            r.push([p[0], p[1] + epsilon]);</span></span>
<span id="cb20-171"><a href="#cb20-171" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb20-172"><a href="#cb20-172" aria-hidden="true" tabindex="-1"></a><span class="in">      r.push(r[0]);</span></span>
<span id="cb20-173"><a href="#cb20-173" aria-hidden="true" tabindex="-1"></a><span class="in">      return r;</span></span>
<span id="cb20-174"><a href="#cb20-174" aria-hidden="true" tabindex="-1"></a><span class="in">    });</span></span>
<span id="cb20-175"><a href="#cb20-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-176"><a href="#cb20-176" aria-hidden="true" tabindex="-1"></a><span class="in">    // Record the y-intersections with the antimeridian.</span></span>
<span id="cb20-177"><a href="#cb20-177" aria-hidden="true" tabindex="-1"></a><span class="in">    p.coordinates.forEach(function(ring) {</span></span>
<span id="cb20-178"><a href="#cb20-178" aria-hidden="true" tabindex="-1"></a><span class="in">      ring.forEach(function(p) {</span></span>
<span id="cb20-179"><a href="#cb20-179" aria-hidden="true" tabindex="-1"></a><span class="in">        if (p[0] === -180 || p[0] === 180) {</span></span>
<span id="cb20-180"><a href="#cb20-180" aria-hidden="true" tabindex="-1"></a><span class="in">          shared[p[1]] |= p[0] === -180 ? 1 : 2;</span></span>
<span id="cb20-181"><a href="#cb20-181" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb20-182"><a href="#cb20-182" aria-hidden="true" tabindex="-1"></a><span class="in">      });</span></span>
<span id="cb20-183"><a href="#cb20-183" aria-hidden="true" tabindex="-1"></a><span class="in">    });</span></span>
<span id="cb20-184"><a href="#cb20-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-185"><a href="#cb20-185" aria-hidden="true" tabindex="-1"></a><span class="in">    // Offset any unshared antimeridian points to prevent their stitching.</span></span>
<span id="cb20-186"><a href="#cb20-186" aria-hidden="true" tabindex="-1"></a><span class="in">    p.coordinates.forEach(function(ring) {</span></span>
<span id="cb20-187"><a href="#cb20-187" aria-hidden="true" tabindex="-1"></a><span class="in">      ring.forEach(function(p) {</span></span>
<span id="cb20-188"><a href="#cb20-188" aria-hidden="true" tabindex="-1"></a><span class="in">        if ((p[0] === -180 || p[0] === 180) &amp;&amp; shared[p[1]] !== 3) {</span></span>
<span id="cb20-189"><a href="#cb20-189" aria-hidden="true" tabindex="-1"></a><span class="in">          p[0] = p[0] === -180 ? -179.9995 : 179.9995;</span></span>
<span id="cb20-190"><a href="#cb20-190" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb20-191"><a href="#cb20-191" aria-hidden="true" tabindex="-1"></a><span class="in">      });</span></span>
<span id="cb20-192"><a href="#cb20-192" aria-hidden="true" tabindex="-1"></a><span class="in">    });</span></span>
<span id="cb20-193"><a href="#cb20-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-194"><a href="#cb20-194" aria-hidden="true" tabindex="-1"></a><span class="in">    p = d3.geoStitch(p);</span></span>
<span id="cb20-195"><a href="#cb20-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-196"><a href="#cb20-196" aria-hidden="true" tabindex="-1"></a><span class="in">    // After stitching remove the shared points -- they are off</span></span>
<span id="cb20-197"><a href="#cb20-197" aria-hidden="true" tabindex="-1"></a><span class="in">    // see https://github.com/d3/d3-contour/issues/25</span></span>
<span id="cb20-198"><a href="#cb20-198" aria-hidden="true" tabindex="-1"></a><span class="in">    p.coordinates = p.coordinates</span></span>
<span id="cb20-199"><a href="#cb20-199" aria-hidden="true" tabindex="-1"></a><span class="in">    .map(function(ring) {</span></span>
<span id="cb20-200"><a href="#cb20-200" aria-hidden="true" tabindex="-1"></a><span class="in">      ring.pop();</span></span>
<span id="cb20-201"><a href="#cb20-201" aria-hidden="true" tabindex="-1"></a><span class="in">      ring = ring</span></span>
<span id="cb20-202"><a href="#cb20-202" aria-hidden="true" tabindex="-1"></a><span class="in">      .map(function(p) {</span></span>
<span id="cb20-203"><a href="#cb20-203" aria-hidden="true" tabindex="-1"></a><span class="in">        var p0 = (p[0] + 180) * (isize + 1) / isize - 180;</span></span>
<span id="cb20-204"><a href="#cb20-204" aria-hidden="true" tabindex="-1"></a><span class="in">        return [p0, p[1]];</span></span>
<span id="cb20-205"><a href="#cb20-205" aria-hidden="true" tabindex="-1"></a><span class="in">      });</span></span>
<span id="cb20-206"><a href="#cb20-206" aria-hidden="true" tabindex="-1"></a><span class="in">      ring = ring.filter(function(p) {</span></span>
<span id="cb20-207"><a href="#cb20-207" aria-hidden="true" tabindex="-1"></a><span class="in">        return Math.abs(p[0]) &lt; 179.9999;</span></span>
<span id="cb20-208"><a href="#cb20-208" aria-hidden="true" tabindex="-1"></a><span class="in">      });</span></span>
<span id="cb20-209"><a href="#cb20-209" aria-hidden="true" tabindex="-1"></a><span class="in">      ring.push(ring[0]);</span></span>
<span id="cb20-210"><a href="#cb20-210" aria-hidden="true" tabindex="-1"></a><span class="in">      return ring;</span></span>
<span id="cb20-211"><a href="#cb20-211" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb20-212"><a href="#cb20-212" aria-hidden="true" tabindex="-1"></a><span class="in">    .filter(function(ring) {</span></span>
<span id="cb20-213"><a href="#cb20-213" aria-hidden="true" tabindex="-1"></a><span class="in">      return ring.length &gt; 0;</span></span>
<span id="cb20-214"><a href="#cb20-214" aria-hidden="true" tabindex="-1"></a><span class="in">    });</span></span>
<span id="cb20-215"><a href="#cb20-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-216"><a href="#cb20-216" aria-hidden="true" tabindex="-1"></a><span class="in">    // If the MultiPolygon is empty, treat it as the Sphere.</span></span>
<span id="cb20-217"><a href="#cb20-217" aria-hidden="true" tabindex="-1"></a><span class="in">    return p.coordinates.length</span></span>
<span id="cb20-218"><a href="#cb20-218" aria-hidden="true" tabindex="-1"></a><span class="in">        ? {type: "Polygon", coordinates: p.coordinates, value: d.value}</span></span>
<span id="cb20-219"><a href="#cb20-219" aria-hidden="true" tabindex="-1"></a><span class="in">        : {type: "Sphere", value: d.value};</span></span>
<span id="cb20-220"><a href="#cb20-220" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb20-221"><a href="#cb20-221" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb20-222"><a href="#cb20-222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-223"><a href="#cb20-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-226"><a href="#cb20-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-227"><a href="#cb20-227" aria-hidden="true" tabindex="-1"></a><span class="in">function topdown(values) {</span></span>
<span id="cb20-228"><a href="#cb20-228" aria-hidden="true" tabindex="-1"></a><span class="in">  var v = new Float32Array(values);</span></span>
<span id="cb20-229"><a href="#cb20-229" aria-hidden="true" tabindex="-1"></a><span class="in">  for (var j = 0; j &lt; jsize; j++) {</span></span>
<span id="cb20-230"><a href="#cb20-230" aria-hidden="true" tabindex="-1"></a><span class="in">    for (var i = 0; i &lt; isize; i++) {</span></span>
<span id="cb20-231"><a href="#cb20-231" aria-hidden="true" tabindex="-1"></a><span class="in">      v[ (jsize-1-j) * isize + i ] = values[ j * isize + i ];</span></span>
<span id="cb20-232"><a href="#cb20-232" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb20-233"><a href="#cb20-233" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb20-234"><a href="#cb20-234" aria-hidden="true" tabindex="-1"></a><span class="in">  return v;</span></span>
<span id="cb20-235"><a href="#cb20-235" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb20-236"><a href="#cb20-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-237"><a href="#cb20-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-240"><a href="#cb20-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-241"><a href="#cb20-241" aria-hidden="true" tabindex="-1"></a><span class="in">// torus: copy left column to the right</span></span>
<span id="cb20-242"><a href="#cb20-242" aria-hidden="true" tabindex="-1"></a><span class="in">function cylinder(values) {</span></span>
<span id="cb20-243"><a href="#cb20-243" aria-hidden="true" tabindex="-1"></a><span class="in">  var v = new Float32Array(jsize * (isize+1));</span></span>
<span id="cb20-244"><a href="#cb20-244" aria-hidden="true" tabindex="-1"></a><span class="in">  for (var j = 0; j &lt; jsize; j++) {</span></span>
<span id="cb20-245"><a href="#cb20-245" aria-hidden="true" tabindex="-1"></a><span class="in">    for (var i = 0; i &lt; isize + 1; i++) {</span></span>
<span id="cb20-246"><a href="#cb20-246" aria-hidden="true" tabindex="-1"></a><span class="in">      v[ j * (isize+1) + i ] = values[ j * isize + i%isize ];</span></span>
<span id="cb20-247"><a href="#cb20-247" aria-hidden="true" tabindex="-1"></a><span class="in">     }</span></span>
<span id="cb20-248"><a href="#cb20-248" aria-hidden="true" tabindex="-1"></a><span class="in"> }</span></span>
<span id="cb20-249"><a href="#cb20-249" aria-hidden="true" tabindex="-1"></a><span class="in"> return v;</span></span>
<span id="cb20-250"><a href="#cb20-250" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb20-251"><a href="#cb20-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-252"><a href="#cb20-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-255"><a href="#cb20-255" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-256"><a href="#cb20-256" aria-hidden="true" tabindex="-1"></a><span class="in">contours = d3.contours()</span></span>
<span id="cb20-257"><a href="#cb20-257" aria-hidden="true" tabindex="-1"></a><span class="in">      .smooth(true)</span></span>
<span id="cb20-258"><a href="#cb20-258" aria-hidden="true" tabindex="-1"></a><span class="in">      .size([isize + 1, jsize])</span></span>
<span id="cb20-259"><a href="#cb20-259" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-260"><a href="#cb20-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-263"><a href="#cb20-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb20-264"><a href="#cb20-264" aria-hidden="true" tabindex="-1"></a><span class="in">polygons</span></span>
<span id="cb20-265"><a href="#cb20-265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://www.caltech.edu/"><img src="./img/Caltech_Logo.png" alt="Caltech" height="20"></a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="https://carnegiescience.edu/"><img src="./img/Carnegie.svg" alt="Carnegie" height="20"></a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="https://eps.harvard.edu/"><img src="./img/img_acmg_logo_seas.png" alt="Harvard" height="20"></a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://scholar.google.com/citations?user=7XYDtdYAAAAJ&amp;hl=en">
<p><i class="ai  ai-google-scholar"></i> Google Scholar</p>
</a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/chr_fronge">
      <i class="bi bi-twitter" role="img" aria-label="PI Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/RemoteSensingTools/">
      <i class="bi bi-github" role="img" aria-label="Quarto GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>